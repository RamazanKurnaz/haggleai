{% schema %}
{
  "name": "HaggleAI Chat Embed",
  "target": "body",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_widget",
      "label": "Enable HaggleAI Chat",
      "default": true
    },
    {
      "type": "text",
      "id": "app_proxy_path",
      "label": "App proxy path",
      "default": "/apps/haggle"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#6366f1"
    }
  ]
}
{% endschema %}

{% if block.settings.enable_widget %}
  {% if template.name == 'product' and product %}
    <div id="haggle-ai-root" 
         data-product-id="{{ product.id }}" 
         data-variant-id="{{ product.selected_or_first_available_variant.id }}"
         data-product-title="{{ product.title | escape }}"
         data-product-price="{{ product.price | money_without_currency | remove: ',' }}"
         data-shop-domain="{{ shop.permanent_domain }}"
         data-button-color="{{ block.settings.button_color }}"
         data-app-url="{{ block.settings.app_proxy_path }}"
    ></div>
    
    {{ 'haggle-chat.css' | asset_url | stylesheet_tag }}
    <script src="{{ 'haggle-chat.js' | asset_url }}" defer></script>
  {% endif %}
{% endif %}

